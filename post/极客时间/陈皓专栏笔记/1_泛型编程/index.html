<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>泛型编程 - Alfons&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Alfons" /><meta name="description" content="泛型编程" /><meta name="keywords" content="极客时间, 陈皓专栏笔记" />






<meta name="generator" content="Hugo 0.123.8 with theme even" />


<link rel="canonical" href="https://alfonsxh.github.io/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E9%99%88%E7%9A%93%E4%B8%93%E6%A0%8F%E7%AC%94%E8%AE%B0/1_%E6%B3%9B%E5%9E%8B%E7%BC%96%E7%A8%8B/" />
<link rel="apple-touch-icon" sizes="180x180" href="https://alfonsxh.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://alfonsxh.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://alfonsxh.github.io/favicon-16x16.png">
<link rel="manifest" href="https://alfonsxh.github.io/manifest.json">
<link rel="mask-icon" href="https://alfonsxh.github.io/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="https://alfonsxh.github.io/sass/main.min.cb68f97bc9cece255d217346d970e3c62623408634e500c330a62fadabbbe77c.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">





<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="https://alfonsxh.github.io/" class="logo">Alfons&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="https://alfonsxh.github.io/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="https://alfonsxh.github.io/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="https://alfonsxh.github.io/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="https://alfonsxh.github.io/leetcodes/">
        <li class="mobile-menu-item">LeetCodes</li>
      </a><a href="https://alfonsxh.github.io/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="https://alfonsxh.github.io/" class="logo">Alfons&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/leetcodes/">LeetCodes</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">泛型编程</h1>

      <div class="post-meta">
        <span class="post-time"> 2019-04-17 </span>
        <div class="post-category">
            <a href="https://alfonsxh.github.io/categories/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/"> 极客时间 </a>
            <a href="https://alfonsxh.github.io/categories/%E9%99%88%E7%9A%93%E4%B8%93%E6%A0%8F%E7%AC%94%E8%AE%B0/"> 陈皓专栏笔记 </a>
            </div>
          <span class="more-meta"> 711 words </span>
          <span class="more-meta"> 4 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="https://alfonsxh.github.io/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#泛型编程的含义">泛型编程的含义</a></li>
        <li><a href="#c语言泛型">C语言泛型</a>
          <ul>
            <li><a href="#swap-函数">swap 函数</a></li>
            <li><a href="#search-函数">search 函数</a></li>
            <li><a href="#小结">小结</a></li>
          </ul>
        </li>
        <li><a href="#c泛型">C++泛型</a>
          <ul>
            <li><a href="#reduce函数">reduce函数</a></li>
            <li><a href="#小结-1">小结</a></li>
          </ul>
        </li>
        <li><a href="#类型系统与泛型编程">类型系统与泛型编程</a>
          <ul>
            <li><a href="#类型系统">类型系统</a></li>
            <li><a href="#泛型的本质">泛型的本质</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <h2 id="泛型编程的含义">泛型编程的含义</h2>
<p>在编程的时候，总会遇到 <strong>同样的逻辑但是所需的类型不同</strong> 的问题。理想情况下，<strong>算法应是和数据结构和类型无关的，各种特殊的数据类型理应做好自己分内的工作</strong>。</p>
<blockquote>
<p>Generic programming centers around the idea of abstracting from concrete, efficient algorithms
to obtain generic algorithms that can be combined with different data representations to produce
a wide variety of useful software.
— Musser, David R.; Stepanov, Alexander A., Generic Programming</p>
</blockquote>
<p>上面的话，翻译过来就是&mdash;- <strong>屏蔽掉数据和操作数据的细节，让算法更为通用，让编程者更多地关注算法的结构，而不是在算法中处理不同的数据类型</strong>。</p>
<h2 id="c语言泛型">C语言泛型</h2>
<p>c语言虽然在底层的微观控制上有很大的作用，但在泛型上做的不是很好。</p>
<h3 id="swap-函数">swap 函数</h3>
<p>交换两个变量的swap函数。</p>
<p>函数实现：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">/// 交换两个值
</span></span></span><span class="line"><span class="cl"><span class="c1">/// 给定了交换值的类型，如果需要交换别的类型的值，则需要另一个函数
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param x 传入参数指针
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param y 传入参数指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">SwapInt</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">temp</span> <span class="o">=</span> <span class="o">*</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">x</span> <span class="o">=</span> <span class="o">*</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">*</span><span class="n">y</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">/// 交换两个值
</span></span></span><span class="line"><span class="cl"><span class="c1">/// 使用 void * 代替普通类型
</span></span></span><span class="line"><span class="cl"><span class="c1">/// 由于使用void * ，编译器不能通过类型得到类型的尺寸，添加 size 参数表示类型的长度
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param x 传入参数指针
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param y 传入参数指针
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param size 传入指针大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">SwapVoid</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">char</span> <span class="n">tmp</span><span class="p">[</span><span class="n">size</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nf">memcpy</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">memcpy</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nf">memcpy</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 交换两个值，宏定义模式
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 宏定义的方式有个弊端，在使用宏定义时，由于宏替换的缘故，会导致传入的参数发生改变
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 例如：
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * #define min(x, y)  ((x)&gt;(y) ? (y) : (x))
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 在使用此宏时  int k = min(i++, j++);
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 由于宏替换的缘故，相当于执行了
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * (i++) &gt; (j++) ? (j++) : (i++)
</span></span></span><span class="line"><span class="cl"><span class="cm"> *
</span></span></span><span class="line"><span class="cl"><span class="cm"> * x 或 y 的值会被累加两次
</span></span></span><span class="line"><span class="cl"><span class="cm"> * */</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define swap(x, y, size) {\
</span></span></span><span class="line"><span class="cl"><span class="cp">    char temp[size]; \
</span></span></span><span class="line"><span class="cl"><span class="cp">    memcpy(temp, &amp;y, size); \
</span></span></span><span class="line"><span class="cl"><span class="cp">    memcpy(&amp;y,   &amp;x, size); \
</span></span></span><span class="line"><span class="cl"><span class="cp">    memcpy(&amp;x, temp, size); \
</span></span></span><span class="line"><span class="cl"><span class="cp">}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="search-函数">search 函数</h3>
<p>搜索输入对象中是否含有目标。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c" data-lang="c"><span class="line"><span class="cl"><span class="c1">/// 在int 指针对象中搜索目标出现的位置，在此版本中传入对象的类型一定，目标一定
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param a 传入对象
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param size 对象长度
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param target 目标
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \return 目标所在位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">SearchNormal</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">target</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">/// 查找泛型函数
</span></span></span><span class="line"><span class="cl"><span class="c1">/// - 输入对象任意
</span></span></span><span class="line"><span class="cl"><span class="c1">/// - 偏移依靠元素 size * i 实现
</span></span></span><span class="line"><span class="cl"><span class="c1">/// - 对比函数由外界提供
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param a 传入对象
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param size 传入对象长度
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param target 目标
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param elem_size 传入对象元素大小
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param cmpFn 对比函数
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \return 目标所在位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">SearchParadigm</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">target</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">elem_size</span><span class="p">,</span> <span class="kt">int</span><span class="p">(</span><span class="o">*</span><span class="n">cmpFn</span><span class="p">)(</span><span class="kt">void</span><span class="o">*</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span><span class="p">)){</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nf">cmpFn</span><span class="p">((</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">a</span> <span class="o">+</span> <span class="n">elem_size</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">/// int 类型比较操作
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param x 待比较的参数1
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param y 待比较的参数2
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \return 比较结果， 0为相等
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">int_cmp</span><span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="o">*</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">/// char 类型比较操作
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param x 待比较的参数1
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \param y 待比较的参数2
</span></span></span><span class="line"><span class="cl"><span class="c1">/// \return 比较结果， 0为相等
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="nf">string_cmp</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">y</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">strcmp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="小结">小结</h3>
<p>在search函数中，传入了比较函数，这种方式将比较的过程由用户自己定义，能够适配更多类型的对象，自由度加大。</p>
<p>但在使用c语言时，在适配数据类型的过程中，只能使用<code>void*</code>或<code>宏</code>代替，这两种类型带来了很多其他的问题。</p>
<h2 id="c泛型">C++泛型</h2>
<p>C++ 是支持编程范式最多的一门语言，解决了C语言泛型编程的问题。</p>
<ul>
<li>通过类的方式
<ul>
<li>类中会有构造函数、析构函数表示这个类的分配和释放</li>
<li>拷贝构造函数，表示对内存的复制</li>
<li>操作符重载，用于比较大小、等于、不等于</li>
</ul>
</li>
<li>通过模板达到类型和算法的妥协
<ul>
<li>模板特化会根据使用者的类型在编译时期生成那个模板的代码</li>
<li>模板可以通过一个虚拟的类型进行绑定，这样不会导致类型转换时的问题</li>
</ul>
</li>
<li>通过虚函数和运行时类型识别
<ul>
<li>虚函数带来多态在语义上可以支持&quot;同一类&quot;的类型泛型</li>
<li>运行时类型识别技术可以做到在泛型时对具体类型的特殊处理</li>
</ul>
</li>
</ul>
<h3 id="reduce函数">reduce函数</h3>
<p>下面的例子是使用C++模板实现泛型编程。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Iter</span><span class="p">,</span> <span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Op</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">T</span> <span class="n">reduce</span><span class="p">(</span><span class="n">Iter</span> <span class="n">start</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">end</span><span class="p">,</span> <span class="n">T</span> <span class="n">init</span><span class="p">,</span> <span class="n">Op</span> <span class="n">op</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">T</span> <span class="n">result</span> <span class="o">=</span> <span class="n">init</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(;</span> <span class="n">start</span> <span class="o">!=</span> <span class="n">end</span><span class="p">;</span> <span class="n">start</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">result</span> <span class="o">=</span> <span class="n">op</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="o">*</span><span class="n">start</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Employee</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">string</span> <span class="n">id</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">vacation</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">double</span> <span class="n">salary</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Cond</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">counter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Cond</span> <span class="n">cond</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">size_t</span> <span class="nf">operator</span><span class="p">()(</span><span class="n">size_t</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">c</span> <span class="o">+</span> <span class="p">(</span><span class="n">cond</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">template</span><span class="o">&lt;</span><span class="k">class</span> <span class="nc">Iter</span><span class="p">,</span> <span class="k">class</span> <span class="nc">Cond</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">size_t</span> <span class="n">count_if</span><span class="p">(</span><span class="n">Iter</span> <span class="n">begin</span><span class="p">,</span> <span class="n">Iter</span> <span class="n">end</span><span class="p">,</span> <span class="n">Cond</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">op</span> <span class="o">=</span> <span class="n">counter</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">Iter</span><span class="o">::</span><span class="n">value_type</span><span class="p">,</span> <span class="n">Cond</span><span class="o">&gt;</span><span class="p">{</span><span class="n">c</span><span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nf">reduce</span><span class="p">(</span><span class="n">begin</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">size_t</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">op</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>reduce函数的作用只是遍历迭代对象，reduce函数的传入参数init为结果的初始化值，op为对迭代对象的操作。这样做的好处在于，使得程序的扩展性得到了很大的提升。</p>
<p>例如现在需要计算所有工资的总和，只需要编写一个相加的函数即可。当使用别的功能函数后，又变成了新的功能。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="n">vector</span><span class="o">&lt;</span><span class="n">Employee</span><span class="o">&gt;</span> <span class="n">v_employee</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Employee</span> <span class="n">employee_001</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;Tom&#34;</span><span class="p">,</span> <span class="s">&#34;001&#34;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">10000.0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">v_employee</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">employee_001</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Employee</span> <span class="n">employee_002</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;John&#34;</span><span class="p">,</span> <span class="s">&#34;002&#34;</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mf">220.0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">v_employee</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">employee_002</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Employee</span> <span class="n">employee_003</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;Alfons&#34;</span><span class="p">,</span> <span class="s">&#34;003&#34;</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">9000.0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">v_employee</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">employee_003</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">Employee</span> <span class="n">employee_004</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#34;Mich&#34;</span><span class="p">,</span> <span class="s">&#34;004&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">101000.0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="n">v_employee</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">employee_004</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">double</span> <span class="n">sum_salaries</span> <span class="o">=</span> <span class="n">reduce</span><span class="p">(</span><span class="n">v_employee</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">v_employee</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mf">0.0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="p">[](</span><span class="kt">double</span> <span class="n">s</span><span class="p">,</span> <span class="n">Employee</span> <span class="n">e</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">double</span> <span class="p">{</span> <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="n">e</span><span class="p">.</span><span class="n">salary</span><span class="p">;</span> <span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="小结-1">小结</h3>
<p>C++的模板方式极大的扩展了c语言的泛型编程方式。reduce函数只是遍历迭代对象，真正的功能函数被当成输入参数，由用户传入，极大的扩展了用户的自由度。</p>
<h2 id="类型系统与泛型编程">类型系统与泛型编程</h2>
<p>泛型编程的主要目的是 <strong>使得我们编写的代码不依赖于指定的类型</strong>，这自然绕不过 <strong>类型系统</strong>。</p>
<h3 id="类型系统">类型系统</h3>
<p><strong>类型系统</strong> 用于定义如何将编程语言中的数值和表达式归类为许多不同的类型，如何操作这些类型，这些类型如何互相作用。</p>
<p>一般来说，编程语言的类型有两种：</p>
<ul>
<li><strong>内建类型</strong> - int、float、char等</li>
<li><strong>抽象类型</strong> - struct、class、function等</li>
</ul>
<p>抽象类型在程序运行中，可能不表示为值。类型系统在各种语言之间有非常大的不同，最主要的差异在于 <strong>编译时期的语法，以及运行时期的操作实现方式</strong>。</p>
<p>实际上，<strong>类型系统</strong> 的存在根本原因还是对 <strong>内存的分配问题</strong>。</p>
<ul>
<li>类型是对内存的一种抽象，不同的类型，会有不同的内存布局和内存分配的策略。</li>
<li>不同的类型有不同的操作，对于特定的类型，也有特定的操作。</li>
<li>对于 <strong>静态类型语言</strong> 来说
<ul>
<li>类型的检测发生在 <strong>编译器进行语义分析时进行的</strong>，这样做的好处在于，可以让编译器明确的知道程序员的意图，可以利用这一消息做很多代码优化工作，转换成更高效的机器指令，使得程序运行的更快。</li>
<li>在编译时期就可以较早的发现错误，并且增加运行时期的性能。</li>
</ul>
</li>
<li>对于 <strong>动态类型语言</strong> 来说
<ul>
<li>类型的检测发生在 <strong>运行时期做动态类型标记和相关检测</strong>，所以，动态类型语言中会有很多类型判断的函数：is_int(),is_string()等。</li>
<li>程序员可以将更多的精力放在 <strong>程序业务、逻辑的处理上</strong>，能够更快的编写程序。但是会经常出现类型错误的问题。</li>
</ul>
</li>
</ul>
<h3 id="泛型的本质">泛型的本质</h3>
<p>在编程中，我们需要处理好两件事：</p>
<ul>
<li>编程语言中的类型问题</li>
<li>对真实世界中业务代码的抽象、重用和拼装</li>
</ul>
<p>要做到泛型，我们需要做下面的事情：</p>
<ul>
<li>标准化类型的内存分配、释放和访问。</li>
<li>标准化类型的操作：比较操作、IO操作、复制操作&hellip;</li>
<li>标准化数据容器的操作：查找算法、过滤算法、聚合算法&hellip;</li>
<li>标准化类型上的特有操作，需要有标准化的接口来回调不同类型的具体操作&hellip;</li>
</ul>
<p>回到开头的那句话，泛型编程的本质&mdash;-屏蔽掉数据和操作数据的细节，让算法更为通用，让编程者更多地关注算法的结构，而不是在算法中处理不同的数据类型。</p>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Alfons</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2019-04-17
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a href= "https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en"> Creative Commons BY-NC-ND 3.0 </a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="https://alfonsxh.github.io/tags/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/">极客时间</a>
          <a href="https://alfonsxh.github.io/tags/%E9%99%88%E7%9A%93%E4%B8%93%E6%A0%8F%E7%AC%94%E8%AE%B0/">陈皓专栏笔记</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="https://alfonsxh.github.io/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E8%AE%B8%E5%BC%8F%E4%BC%9F%E7%9A%84%E6%9E%B6%E6%9E%84%E8%AF%BE/01_%E6%9E%B6%E6%9E%84%E5%B8%88%E7%9A%84%E5%AE%8F%E8%A7%82%E8%A7%86%E8%A7%92/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">架构师的宏观视角</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="https://alfonsxh.github.io/post/%E6%9E%81%E5%AE%A2%E6%97%B6%E9%97%B4/%E9%99%88%E7%9A%93%E4%B8%93%E6%A0%8F%E7%AC%94%E8%AE%B0/2_%E7%BC%96%E7%A8%8B%E7%9A%84%E6%9C%AC%E8%B4%A8/">
            <span class="next-text nav-default">编程的本质</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
        repo= 'Alfonsxh/Blog'
        issue-term= "pathname"
        theme= 'github-light'
        crossorigin= "anonymous"
        async>
    </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/Alfonsxh" class="iconfont icon-github" title="github"></a>
  <a href="https://alfonsxh.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="https://alfonsxh.github.io/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="https://alfonsxh.github.io/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2022 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span><span>Alfons</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="https://alfonsxh.github.io/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
