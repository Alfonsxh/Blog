<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Python 性能分析 - Alfons&#39;s Blog</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Alfons" /><meta name="description" content="Python 性能分析" /><meta name="keywords" content="Python" />






<meta name="generator" content="Hugo 0.123.8 with theme even" />


<link rel="canonical" href="https://alfonsxh.github.io/post/python/python%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/" />
<link rel="apple-touch-icon" sizes="180x180" href="https://alfonsxh.github.io/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://alfonsxh.github.io/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://alfonsxh.github.io/favicon-16x16.png">
<link rel="manifest" href="https://alfonsxh.github.io/manifest.json">
<link rel="mask-icon" href="https://alfonsxh.github.io/safari-pinned-tab.svg" color="#5bbad5">

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<link href="https://alfonsxh.github.io/sass/main.min.cb68f97bc9cece255d217346d970e3c62623408634e500c330a62fadabbbe77c.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">





<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="https://alfonsxh.github.io/" class="logo">Alfons&#39;s Blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="https://alfonsxh.github.io/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="https://alfonsxh.github.io/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="https://alfonsxh.github.io/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="https://alfonsxh.github.io/leetcodes/">
        <li class="mobile-menu-item">LeetCodes</li>
      </a><a href="https://alfonsxh.github.io/about/">
        <li class="mobile-menu-item">About</li>
      </a>
  </ul>

  


</nav>

  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="https://alfonsxh.github.io/" class="logo">Alfons&#39;s Blog</a>
</div>





<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/leetcodes/">LeetCodes</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="https://alfonsxh.github.io/about/">About</a>
      </li>
  </ul>
</nav>

    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Python 性能分析</h1>

      <div class="post-meta">
        <span class="post-time"> 2020-06-03 </span>
        <div class="post-category">
            <a href="https://alfonsxh.github.io/categories/python/"> Python </a>
            </div>
          <span class="more-meta"> 904 words </span>
          <span class="more-meta"> 5 mins read </span>
        <span id="busuanzi_container_page_pv" class="more-meta"> <span id="busuanzi_value_page_pv"><img src="https://alfonsxh.github.io/img/spinner.svg" alt="spinner.svg"/></span> times read </span>
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Contents</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#暴力time性能分析">暴力(time)性能分析</a></li>
        <li><a href="#栈cprofile性能分析">栈(cProfile)性能分析</a></li>
        <li><a href="#可视化性能分析">可视化性能分析</a>
          <ul>
            <li><a href="#gprof2dot">gprof2dot</a></li>
            <li><a href="#vprof">vprof</a></li>
            <li><a href="#pyprof2calltree">pyprof2calltree</a></li>
          </ul>
        </li>
        <li><a href="#第三方工具">第三方工具</a></li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
    <div class="post-content">
      <p>参考几种性能分析的方式。事例代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fib_seq</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">seq</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">seq</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">fib_seq</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">seq</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span> <span class="n">fib_seq</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="暴力time性能分析">暴力(time)性能分析</h2>
<p>最简单的性能分析方式，使用系统命令 <code>time</code>，或者python中的 <code>timeit、time</code> 模块。</p>
<p>使用 <code>time</code> 方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ <span class="nb">time</span> python test_func.py <span class="m">30</span>
</span></span><span class="line"><span class="cl"><span class="o">[</span>0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765, 10946, 17711, 28657, 46368, 75025, 121393, 196418, 317811, 514229, 832040<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">real    0m0.622s
</span></span><span class="line"><span class="cl">user    0m0.610s
</span></span><span class="line"><span class="cl">sys     0m0.012s
</span></span></code></pre></td></tr></table>
</div>
</div><p>整体用时 <strong>0.622s</strong>。</p>
<p>使用python模块的方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">timeit</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">test_func</span> <span class="kn">import</span> <span class="n">fib_seq</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_code</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">fib_seq</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># res = timeit.repeat(test_code, number=1, repeat=5)</span>
</span></span><span class="line"><span class="cl"><span class="n">res</span> <span class="o">=</span> <span class="n">timeit</span><span class="o">.</span><span class="n">timeit</span><span class="p">(</span><span class="n">test_code</span><span class="p">,</span> <span class="n">number</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="s2">&#34;timeit use -&gt; </span><span class="si">{}</span><span class="s2">&#39;s.&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">time</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">fib_seq</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="s2">&#34;time use -&gt; </span><span class="si">{}</span><span class="s2">&#39;s.&#34;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>输出：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">timeit use -&gt; 0.599317073822<span class="s1">&#39;s.
</span></span></span><span class="line"><span class="cl"><span class="s1">time use -&gt; 0.59308218956&#39;</span>s.
</span></span></code></pre></td></tr></table>
</div>
</div><p>上面的方式都比较原始，可大致看出程序的耗时，以及某段代码的耗时，但对于细粒度的具体耗时情况，就没有那么细了。</p>
<h2 id="栈cprofile性能分析">栈(cProfile)性能分析</h2>
<p><code>cProfile</code> 模块是性能分析模块，实际上是继承了标准库 <code>_lsprof.Profiler</code>，对标准库的输出做了一层封装，能够更直观的查看结果。</p>
<p>使用标准库 <code>_lsprof.Profiler</code> 进行性能分析：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">_lsprof</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">test_func</span> <span class="kn">import</span> <span class="n">fib_seq</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">profile</span> <span class="o">=</span> <span class="n">_lsprof</span><span class="o">.</span><span class="n">Profiler</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">profile</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">fib_seq</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">profile</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">res</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">getstats</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># output：_lsprof.profiler_entry(code=&#34;&lt;method &#39;append&#39; of &#39;list&#39; objects&gt;&#34;, callcount=31, reccallcount=0, totaltime=4.9999999999999996e-06, inlinetime=4.9999999999999996e-06, calls=None)</span>
</span></span><span class="line"><span class="cl"><span class="n">_lsprof</span><span class="o">.</span><span class="n">profiler_entry</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s2">&#34;&lt;method &#39;extend&#39; of &#39;list&#39; objects&gt;&#34;</span><span class="p">,</span> <span class="n">callcount</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">reccallcount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totaltime</span><span class="o">=</span><span class="mf">1.7e-05</span><span class="p">,</span> <span class="n">inlinetime</span><span class="o">=</span><span class="mf">1.7e-05</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">_lsprof</span><span class="o">.</span><span class="n">profiler_entry</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s2">&#34;&lt;method &#39;disable&#39; of &#39;_lsprof.Profiler&#39; objects&gt;&#34;</span><span class="p">,</span> <span class="n">callcount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reccallcount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totaltime</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inlinetime</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">_lsprof</span><span class="o">.</span><span class="n">profiler_entry</span><span class="p">(</span><span class="n">code</span><span class="o">=&lt;</span><span class="n">code</span> <span class="nb">object</span> <span class="n">fib</span> <span class="n">at</span> <span class="mh">0x7fcb4698fbb0</span><span class="p">,</span> <span class="n">file</span> <span class="s2">&#34;/mnt/3a4a987a-73ee-49eb-bc4b-b34ee82abd09/PythonCode/Python/cProfileTest/test_func.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">13</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">callcount</span><span class="o">=</span><span class="mi">7049123</span><span class="p">,</span> <span class="n">reccallcount</span><span class="o">=</span><span class="mi">7049092</span><span class="p">,</span> <span class="n">totaltime</span><span class="o">=</span><span class="mf">1.271378</span><span class="p">,</span> <span class="n">inlinetime</span><span class="o">=</span><span class="mf">1.271378</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">_lsprof</span><span class="o">.</span><span class="n">profiler_entry</span><span class="p">(</span><span class="n">code</span><span class="o">=&lt;</span><span class="n">code</span> <span class="nb">object</span> <span class="n">fib_seq</span> <span class="n">at</span> <span class="mh">0x7fcb469a5eb0</span><span class="p">,</span> <span class="n">file</span> <span class="s2">&#34;/mnt/3a4a987a-73ee-49eb-bc4b-b34ee82abd09/PythonCode/Python/cProfileTest/test_func.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">22</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">callcount</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">reccallcount</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">totaltime</span><span class="o">=</span><span class="mf">1.271494</span><span class="p">,</span> <span class="n">inlinetime</span><span class="o">=</span><span class="mf">9.4e-05</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">_lsprof</span><span class="o">.</span><span class="n">profiler_entry</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s2">&#34;&lt;method &#39;append&#39; of &#39;list&#39; objects&gt;&#34;</span><span class="p">,</span> <span class="n">callcount</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">reccallcount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totaltime</span><span class="o">=</span><span class="mf">4.9999999999999996e-06</span><span class="p">,</span> <span class="n">inlinetime</span><span class="o">=</span><span class="mf">4.9999999999999996e-06</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">_lsprof</span><span class="o">.</span><span class="n">profiler_entry</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s2">&#34;&lt;method &#39;extend&#39; of &#39;list&#39; objects&gt;&#34;</span><span class="p">,</span> <span class="n">callcount</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">reccallcount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totaltime</span><span class="o">=</span><span class="mf">1.7e-05</span><span class="p">,</span> <span class="n">inlinetime</span><span class="o">=</span><span class="mf">1.7e-05</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">_lsprof</span><span class="o">.</span><span class="n">profiler_entry</span><span class="p">(</span><span class="n">code</span><span class="o">=</span><span class="s2">&#34;&lt;method &#39;disable&#39; of &#39;_lsprof.Profiler&#39; objects&gt;&#34;</span><span class="p">,</span> <span class="n">callcount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reccallcount</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">totaltime</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">inlinetime</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">calls</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">_lsprof</span><span class="o">.</span><span class="n">profiler_entry</span><span class="p">(</span><span class="n">code</span><span class="o">=&lt;</span><span class="n">code</span> <span class="nb">object</span> <span class="n">fib</span> <span class="n">at</span> <span class="mh">0x7fcb4698fbb0</span><span class="p">,</span> <span class="n">file</span> <span class="s2">&#34;/mnt/3a4a987a-73ee-49eb-bc4b-b34ee82abd09/PythonCode/Python/cProfileTest/test_func.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">13</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">callcount</span><span class="o">=</span><span class="mi">7049123</span><span class="p">,</span> <span class="n">reccallcount</span><span class="o">=</span><span class="mi">7049092</span><span class="p">,</span><span class="n">vprof0</span><span class="p">,</span> <span class="n">file</span> <span class="s2">&#34;/mnt/3a4a987a-73ee-49eb-bc4b-b34ee82abd09/PythonCode/Python/cProfileTest/test_func.py&#34;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">22</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">callcount</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">reccallcount</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">totaltime</span><span class="o">=</span><span class="mf">1.271494</span><span class="p">,</span> <span class="n">inlinetime</span><span class="o">=</span><span class="mf">9.4e-05</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 <code>cProfile</code> 模块进行性能分析，结果就更加直观了：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">cProfile</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">test_func</span> <span class="kn">import</span> <span class="n">fib_seq</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">profile</span> <span class="o">=</span> <span class="n">cProfile</span><span class="o">.</span><span class="n">Profile</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">profile</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">fib_seq</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">profile</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">profile</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#output</span>
</span></span><span class="line"><span class="cl">         <span class="mi">7049216</span> <span class="n">function</span> <span class="n">calls</span> <span class="p">(</span><span class="mi">94</span> <span class="n">primitive</span> <span class="n">calls</span><span class="p">)</span> <span class="ow">in</span> <span class="mf">1.271</span> <span class="n">seconds</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="n">Ordered</span> <span class="n">by</span><span class="p">:</span> <span class="n">standard</span> <span class="n">name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="n">ncalls</span>  <span class="n">tottime</span>  <span class="n">percall</span>  <span class="n">cumtime</span>  <span class="n">percall</span> <span class="n">filename</span><span class="p">:</span><span class="n">lineno</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">7049123</span><span class="o">/</span><span class="mi">31</span>    <span class="mf">1.271</span>    <span class="mf">0.000</span>    <span class="mf">1.271</span>    <span class="mf">0.041</span> <span class="n">test_func</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">13</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">     <span class="mi">31</span><span class="o">/</span><span class="mi">1</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">1.271</span>    <span class="mf">1.271</span> <span class="n">test_func</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span><span class="p">(</span><span class="n">fib_seq</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">       <span class="mi">31</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">method</span> <span class="s1">&#39;append&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="mi">1</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">method</span> <span class="s1">&#39;disable&#39;</span> <span class="n">of</span> <span class="s1">&#39;_lsprof.Profiler&#39;</span> <span class="n">objects</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">       <span class="mi">30</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span> <span class="p">{</span><span class="n">method</span> <span class="s1">&#39;extend&#39;</span> <span class="n">of</span> <span class="s1">&#39;list&#39;</span> <span class="n">objects</span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>整体用时 <strong>1.271s</strong>，一共进行了 <strong>7049216次</strong> 函数调用，其中原生函数调用 <strong>94次</strong>，其余的函数调用为递归或者重复调用。</p>
<p>title名解释：</p>
<ul>
<li><strong>ncalls</strong> - 函数调用次数，<strong>7049123/31</strong> 表示，<strong>7049123</strong> 次调用，<strong>31</strong> 次为原生调用，剩余的为重复调用。</li>
<li><strong>tottime</strong> - <strong>internal time</strong>，内部耗时，给定函数的所有执行时间（排除了子函数执行时间）</li>
<li><strong>percall</strong> - <strong>tottime/ncalls</strong>，单次调用所耗时间，除的是所有调用次数</li>
<li><strong>cumtime</strong> - <strong>cumulative time</strong>，累计时间，所有执行时间，包括子函数</li>
<li><strong>percall</strong> - <strong>cumtime/ncalls</strong>，单次调用所耗时间，除的是不重复调用次数</li>
<li><strong>filename:lineno</strong> - 文件名:行号(函数名)</li>
</ul>
<p><code>cPorfile</code> 模块中的 <strong>profile.print_stats</strong> 方法调用了 <code>pstats</code> 模块。该模块是专门用于打印 <strong>profile</strong> 输出文件。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">print_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sort</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">pstats</span>
</span></span><span class="line"><span class="cl">    <span class="n">pstats</span><span class="o">.</span><span class="n">Stats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">strip_dirs</span><span class="p">()</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">print_stats</span><span class="p">()</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>strip_dirs</strong> - 方法会去除文件夹路径</li>
<li><strong>sort_stats</strong>
<ul>
<li>排序，以关键字进行排序</li>
<li>关键字包含很多，程序中对title中的字符进行了切割作为关键字，例如 <strong>cumulative time</strong> 的关键字可以是 <strong>cumulativ</strong>、<strong>cumulati</strong>、<strong>cumu</strong></li>
<li>一般使用title中的名字即可</li>
<li>也支持多个关键字排序，如 <strong>sort_stats(&ldquo;cumtime&rdquo;, &ldquo;filename&rdquo;)</strong></li>
</ul>
</li>
<li><strong>print_stats</strong>
<ul>
<li>打印结果，带过滤功能，输入参数可以是函数名关键字，或者数字，也可以是两者的组合
<ul>
<li>数字可以是整数(int, long)，表示打印排序后，第几位之前的内容</li>
<li>也可以是小数形式(float)，表示输出整个结果的前面百分比，如 <strong>0.1</strong> 表示输出前面10%的内容</li>
</ul>
</li>
<li>函数名和数字的前后关系，会导致结果的不同
<ul>
<li><strong>print_stats(&ldquo;fib&rdquo;, 0.5)</strong> - 输出包含 <strong>fib</strong> 的函数的前50%的内容</li>
<li><strong>print_stats(0.5, &ldquo;fib&rdquo;)</strong> - 输出前50%内容，其中函数名中需要包含 <strong>fib</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p>(注：其他的一些函数，如 <strong>print_callees</strong>、<strong>print_callers</strong> 使用类似)</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nb">print</span> <span class="s1">&#39;print_stats(&#34;fib&#34;, 0.5)&#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="s2">&#34;cumu&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="s2">&#34;fib&#34;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span> <span class="s1">&#39;print_stats(0.5, &#34;fib&#34;)&#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sort_stats</span><span class="p">(</span><span class="s2">&#34;cumu&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">print_stats</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&#34;fib&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># output:</span>
</span></span><span class="line"><span class="cl"><span class="o">====================</span><span class="n">print_stats</span><span class="p">(</span><span class="s2">&#34;fib&#34;</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">=====================</span>
</span></span><span class="line"><span class="cl">        <span class="mi">7049216</span> <span class="n">function</span> <span class="n">calls</span> <span class="p">(</span><span class="mi">94</span> <span class="n">primitive</span> <span class="n">calls</span><span class="p">)</span> <span class="ow">in</span> <span class="mf">1.257</span> <span class="n">seconds</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Ordered</span> <span class="n">by</span><span class="p">:</span> <span class="n">cumulative</span> <span class="n">time</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span> <span class="n">reduced</span> <span class="kn">from</span> <span class="mi">5</span> <span class="n">to</span> <span class="mi">2</span> <span class="n">due</span> <span class="n">to</span> <span class="n">restriction</span> <span class="o">&lt;</span><span class="s1">&#39;fib&#39;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span> <span class="n">reduced</span> <span class="kn">from</span> <span class="mi">2</span> <span class="n">to</span> <span class="mi">1</span> <span class="n">due</span> <span class="n">to</span> <span class="n">restriction</span> <span class="o">&lt;</span><span class="mf">0.5</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ncalls</span>  <span class="n">tottime</span>  <span class="n">percall</span>  <span class="n">cumtime</span>  <span class="n">percall</span> <span class="n">filename</span><span class="p">:</span><span class="n">lineno</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">31</span><span class="o">/</span><span class="mi">1</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">1.257</span>    <span class="mf">1.257</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="mi">3</span><span class="n">a4a987a</span><span class="o">-</span><span class="mi">73</span><span class="n">ee</span><span class="o">-</span><span class="mi">49</span><span class="n">eb</span><span class="o">-</span><span class="n">bc4b</span><span class="o">-</span><span class="n">b34ee82abd09</span><span class="o">/</span><span class="n">PythonCode</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="n">cProfileTest</span><span class="o">/</span><span class="n">test_func</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span><span class="p">(</span><span class="n">fib_seq</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">====================</span><span class="n">print_stats</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="s2">&#34;fib&#34;</span><span class="p">)</span><span class="o">=====================</span>
</span></span><span class="line"><span class="cl">        <span class="mi">7049216</span> <span class="n">function</span> <span class="n">calls</span> <span class="p">(</span><span class="mi">94</span> <span class="n">primitive</span> <span class="n">calls</span><span class="p">)</span> <span class="ow">in</span> <span class="mf">1.257</span> <span class="n">seconds</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Ordered</span> <span class="n">by</span><span class="p">:</span> <span class="n">cumulative</span> <span class="n">time</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span> <span class="n">reduced</span> <span class="kn">from</span> <span class="mi">5</span> <span class="n">to</span> <span class="mi">3</span> <span class="n">due</span> <span class="n">to</span> <span class="n">restriction</span> <span class="o">&lt;</span><span class="mf">0.5</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="n">List</span> <span class="n">reduced</span> <span class="kn">from</span> <span class="mi">3</span> <span class="n">to</span> <span class="mi">2</span> <span class="n">due</span> <span class="n">to</span> <span class="n">restriction</span> <span class="o">&lt;</span><span class="s1">&#39;fib&#39;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">ncalls</span>  <span class="n">tottime</span>  <span class="n">percall</span>  <span class="n">cumtime</span>  <span class="n">percall</span> <span class="n">filename</span><span class="p">:</span><span class="n">lineno</span><span class="p">(</span><span class="n">function</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="mi">31</span><span class="o">/</span><span class="mi">1</span>    <span class="mf">0.000</span>    <span class="mf">0.000</span>    <span class="mf">1.257</span>    <span class="mf">1.257</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="mi">3</span><span class="n">a4a987a</span><span class="o">-</span><span class="mi">73</span><span class="n">ee</span><span class="o">-</span><span class="mi">49</span><span class="n">eb</span><span class="o">-</span><span class="n">bc4b</span><span class="o">-</span><span class="n">b34ee82abd09</span><span class="o">/</span><span class="n">PythonCode</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="n">cProfileTest</span><span class="o">/</span><span class="n">test_func</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">22</span><span class="p">(</span><span class="n">fib_seq</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="mi">7049123</span><span class="o">/</span><span class="mi">31</span>    <span class="mf">1.257</span>    <span class="mf">0.000</span>    <span class="mf">1.257</span>    <span class="mf">0.041</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="mi">3</span><span class="n">a4a987a</span><span class="o">-</span><span class="mi">73</span><span class="n">ee</span><span class="o">-</span><span class="mi">49</span><span class="n">eb</span><span class="o">-</span><span class="n">bc4b</span><span class="o">-</span><span class="n">b34ee82abd09</span><span class="o">/</span><span class="n">PythonCode</span><span class="o">/</span><span class="n">Python</span><span class="o">/</span><span class="n">cProfileTest</span><span class="o">/</span><span class="n">test_func</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">13</span><span class="p">(</span><span class="n">fib</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>通过 <code>cProfile</code> 模块进行性能分析，主要是通过其产生 <strong>profile</strong> 文件(当然也可以直接打印结果)，后续通过 <code>pstats</code> 模块进行解析，输出结果。</p>
<p>其他的一些 <code>类cProfile</code> 模块也是通过类似的方式进行性能分析，例如 <strong>line_profile</strong>、<strong>memory_profile</strong> 分别进行了函数行执行性能分析以及内存性能分析。</p>
<p>以上的方式，都是通过注入(hook)的方式，<strong>通过函数正常执行时，加入回调函数来实现时间的统计</strong>，或多或少的 <strong>会影响原生函数执行的性能</strong>。例如未使用cProfile模块时，函数的整体执行时间只有 <strong>0.6s</strong>，使用之后为 <strong>1.2s</strong>。这是函数递归调用过多造成的结果。</p>
<p>性能分析的结果，与实际的结果可能存在些许出入，但整体的时间使用分布能够客观反映。</p>
<h2 id="可视化性能分析">可视化性能分析</h2>
<h3 id="gprof2dot">gprof2dot</h3>
<p>需要安装 <strong>gprof2dot</strong> 以及 <strong>graphviz</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install python3 graphviz
</span></span><span class="line"><span class="cl">pip install gprof2dot
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 <strong>gprof2dot</strong> 程序将各种性能分析的结果文件转换，再通过 <strong>dot</strong> 程序将转换后的结果 <strong>输出为各类格式的结果保存</strong>。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">gprof2dot -f pstats ./fib.prof <span class="p">|</span> dot -Tjpg -o fib.jpg
</span></span></code></pre></td></tr></table>
</div>
</div><p>如上的命令，将 <strong>pstats</strong> 类型的 <strong>cProfile</strong> 分析结果转换，再通过 <strong>dot</strong> 程序输出为jpg文件。最终的输出结果图片如下：</p>
<p><img src="https://alfonsxh.github.io/images/Python/Python%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/fib.jpg" alt="fib"></p>
<h3 id="vprof">vprof</h3>
<p>需要安装 <strong>vprof</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pip install vprof
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 <strong>vprof</strong> 可以通过 <strong>-c</strong> 参数将程序按几种类型进行性能分析，包括 <strong>cpu</strong>、<strong>profile</strong>、<strong>memory graph</strong>、<strong>code heatmap</strong>。可以单独使用，也可以结合使用。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ vprof -c cpmh test_func.py
</span></span><span class="line"><span class="cl">Running MemoryProfiler...
</span></span><span class="line"><span class="cl"><span class="o">[</span>0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765<span class="o">]</span>
</span></span><span class="line"><span class="cl">Running FlameGraphProfiler...
</span></span><span class="line"><span class="cl"><span class="o">[</span>0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765<span class="o">]</span>
</span></span><span class="line"><span class="cl">Running CodeHeatmapProfiler...
</span></span><span class="line"><span class="cl"><span class="o">[</span>0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765<span class="o">]</span>
</span></span><span class="line"><span class="cl">Running Profiler...
</span></span><span class="line"><span class="cl"><span class="o">[</span>0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, 233, 377, 610, 987, 1597, 2584, 4181, 6765<span class="o">]</span>
</span></span><span class="line"><span class="cl">Starting HTTP server...
</span></span><span class="line"><span class="cl">正在现有的浏览器会话中打开。
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://alfonsxh.github.io/images/Python/Python%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/vprof_profiler.png" alt="vprof_profiler"></p>
<p>官方示意图：</p>
<p><img src="https://alfonsxh.github.io/images/Python/Python%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/vprof_office.gif" alt="vprof_office"></p>
<h3 id="pyprof2calltree">pyprof2calltree</h3>
<p>需要安装 <strong>pyprof2calltree</strong> 以及 <strong>kcachegrind</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install -y kcachegrind
</span></span><span class="line"><span class="cl">pip install pyprof2calltree
</span></span></code></pre></td></tr></table>
</div>
</div><p>使用 <strong>pyprof2calltree</strong> 将 <strong>cProfile</strong> 分析的结果文件，进行转化</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pyprof2calltree -i ./fib.prof -k
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://alfonsxh.github.io/images/Python/Python%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/pyprof2calltree.png" alt="pyprof2calltree"></p>
<blockquote>
<p>以上可视化工具都是对一些输出结果做的可视化，显示的更加直观，虽然很炫酷，但个人还是更喜欢直接查看prof文件的方式。</p>
</blockquote>
<h2 id="第三方工具">第三方工具</h2>
<p><strong>Application Portfolio Management (APM, 应用性能管理)</strong>，国外厂商 <strong>NewRelic</strong> 和 <strong>AppDynamics</strong>，国内厂商 <strong>OneAPM</strong>。</p>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://blog.vicyu.com/2017/12/26/more-about-python-profiling/">Python性能分析器</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/24495603">Python优化第一步: 性能分析实践</a></li>
<li><a href="https://github.com/jrfonseca/gprof2dot">gprof2dot</a></li>
<li><a href="https://github.com/nvdv/vprof">vprof</a></li>
<li><a href="https://github.com/pwaller/pyprof2calltree/">pyprof2calltree</a></li>
<li><a href="http://blog.oneapm.com/apm-tech/106.html">如何选择一款好的 APM 工具？</a></li>
</ul>
    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">Author</span>
    <span class="item-content">Alfons</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">LastMod</span>
    <span class="item-content">
        2020-06-03
        
    </span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">License</span>
    <span class="item-content"><a href= "https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en"> Creative Commons BY-NC-ND 3.0 </a></span>
  </p>
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="https://alfonsxh.github.io/tags/python/">Python</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="https://alfonsxh.github.io/post/python/python_pyconcrete%E5%8A%A0%E8%A7%A3%E5%AF%86py%E6%96%87%E4%BB%B6/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">Python pyconcrete加解密py文件</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        <a class="next" href="https://alfonsxh.github.io/post/linux/linux%E6%9C%8D%E5%8A%A1%E5%99%A8/linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">
            <span class="next-text nav-default">Linux服务器负载均衡</span>
            <span class="next-text nav-mobile">Next</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  
    <script src="https://utteranc.es/client.js"
        repo= 'Alfonsxh/Blog'
        issue-term= "pathname"
        theme= 'github-light'
        crossorigin= "anonymous"
        async>
    </script>
  <noscript>Please enable JavaScript to view the <a href="https://github.com/utterance">comments powered by utterances.</a></noscript>

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/Alfonsxh" class="iconfont icon-github" title="github"></a>
  <a href="https://alfonsxh.github.io/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - 
    <a class="theme-link" href="https://github.com/olOwOlo/hugo-theme-even">Even</a>
  </span>

  <div class="busuanzi-footer">
    <span id="busuanzi_container_site_pv"> site pv: <span id="busuanzi_value_site_pv"><img src="https://alfonsxh.github.io/img/spinner.svg" alt="spinner.svg"/></span> </span>
      <span class="division">|</span>
    <span id="busuanzi_container_site_uv"> site uv: <span id="busuanzi_value_site_uv"><img src="https://alfonsxh.github.io/img/spinner.svg" alt="spinner.svg"/></span> </span>
  </div>

  <span class="copyright-year">
    &copy; 
    2022 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span><span>Alfons</span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>



<script type="text/javascript" src="https://alfonsxh.github.io/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js"></script>








</body>
</html>
